<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html data-context="Build Apps" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Asset Data  - Legato Docs</title>
<meta content="legato™ is an open source Linux-based embedded platform designed to simplify connected IoT application development" name="description"/>
<meta content="legato, iot" name="keywords"/>
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="19.11.6" name="legato-version"/>
<link href="resources/images/legato.ico" rel="shortcut icon"/>
<link href="resources/images/legato.ico" rel="icon" type="image/x-icon"/>
<link href="resources/images/legato.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="resources/images/legato.ico" rel="apple-touch-icon" type="image/x-icon"/>
<link href="resources/css/style.css" media="screen" rel="stylesheet" type="text/css"/>
<link href="resources/css/font-awesome.css" rel="stylesheet" type="text/css"/>
<!--[if IE]>
    <script src="resources/js/html5shiv.js"></script>
    <script src="resources/js/respond.js"></script>
  <![endif]-->
<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
<script src="resources/js/main.js"></script>
<script src="tocs/Build_Apps_API_Guides.json"></script>
</head>
<body>
<noscript>
<input class="modal-closing-trick" id="modal-closing-trick" type="checkbox"/>
<div id="nojs">
<label for="modal-closing-trick">
<span>You seem to not have Javascript <a href="http://enable-javascript.com">enabled</a>, so site functionality like the search and navigation tree won't work.</span>
</label>
</div>
</noscript>
<div class="wrapper">
<div class="fa fa-bars documentation" id="menu-trigger"></div>
<div id="top">
<header>
<nav>
<a class="navlink" href="/">Introduction</a><a class="navlink selected" href="buildAppsMain.html">Build Apps</a><a class="navlink" href="buildPlatformMain.html">Build Platform</a><a class="navlink" href="aboutMain.html">About</a>
</nav>
</header>
</div>
<div class="white" id="menudocumentation">
<header>
<a href="/"> <img alt="Back to Legato Homepage" id="logo" src="resources/images/legato_logo.png"/></a>
<h2>/ Build Apps</h2>
<nav class="secondary">
<a href="getStarted.html">Get Started</a><a href="concepts.html">Concepts</a><a class="link-selected" href="apiGuidesMain.html">API Guides</a><a href="tools.html">Tools</a><a href="howToMain.html">How To</a><a href="experimentalMain.html">Experimental Features</a>
</nav>
<nav class="ui-front">
<i class="fa fa-search" id="search-icon"></i>
<input id="searchbox" placeholder="Search"/>
</nav>
</header>
</div>
<div id="resizable">
<div id="left">
<div id="tree1"></div>
</div>
</div>
<div class="content">
<div class="header">
<div class="headertitle">
<h1 class="title">Asset Data </h1> </div>
</div><div class="contents">
<div class="textblock"><p>How to use the Asset Data API to manage a smart device.</p>
<h1><a class="anchor" id="avData_Overview"></a>
Overview</h1>
<p>A smart device can control many things - (e.g., temperature sensors, or electronic switches) . Data can be collected from the devices and categorized into variables, settings, and commands. The AirVantage data API lets you work with the variables, settings and commands from a smart device and sync them with the AirVantage Cloud Service.</p>
<p>For more detail regarding the AssetData API, please refer to <a class="el" href="c_le_avdata.html">AirVantage Data API</a>.</p>
<h1><a class="anchor" id="avData_VariablesSettings"></a>
Variables, Settings and Commands</h1>
<p>To control a smart device, call <code>le_avdata_CreateResource</code> API to create a resource, which is referred to with a unique path. "Set" and "Get" functions are included to write and read values on the client (i.e. app) side, and the AirVantage server can read and write values to your app as well.</p>
<p>For example, the device can read the thermostat hardware for the current temperature, and call the "le_avdata_SetFloat" API to store the temperature value to the device, which the AirVantage server can query for the temperature value. </p><pre class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span> Thermostat_GetTemp</div><div class="line">(</div><div class="line">    <span class="keywordtype">void</span></div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="comment">// Reads from the thermostat hardware and returns the current temperature value</span></div><div class="line">}</div><div class="line"> </div><div class="line"> <a class="code" href="le__avdata__interface_8h.html#a9adb41270f7420fd269606c12f0a7c4c">le_avdata_CreateResource</a>(<span class="stringliteral">"/room1/thermostat/temperature"</span>, LE_AVDATA_ACCESS_VARIABLE);</div><div class="line"> </div><div class="line"> <a class="code" href="le__avdata__interface_8h.html#a6b66143f2c24e403f9ede1679cd2af31">le_avdata_SetFloat</a>(<span class="stringliteral">"/room1/thermostat/temperature"</span>, Thermostat_GetTemp());</div></pre><!-- fragment --><p>With each resource, a function can be optionally registered (with the <code>le_avdata_AddResourceEventHandler</code> API) to be called whenever the AirVantage server reads from or writes to the function. This is useful to perform tasks associated with reading/writing sensor data.</p>
<p>For example, when the AirVantage server writes to a temperature setting, a function is called to check the current temperature, and turn on the air conditioning if necessary. </p><pre class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> AccessTempSettingHandler</div><div class="line">(</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* path,</div><div class="line">    le_avdata_AccessType_t accessType,</div><div class="line">    le_avdata_ArgumentListRef_t argumentList,</div><div class="line">    <span class="keywordtype">void</span>* contextPtr</div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="comment">// Obtain the current temperature reading.</span></div><div class="line">    <span class="keywordtype">double</span> currentTemp = Thermostat_GetTemp();</div><div class="line"> </div><div class="line">    <span class="comment">// Obtain the temperature setting from the AirVantage server.</span></div><div class="line">    <span class="keywordtype">double</span> tempSetting = 0;</div><div class="line">    <a class="code" href="le__avdata__interface_8h.html#a2e1b407f6bff2f1b6d6e76e014e71341">le_avdata_GetFloat</a>(path, &amp;tempSetting);</div><div class="line"> </div><div class="line">    <span class="comment">// Turn on the air conditioning if the current temperature differs from the desired temperature by more than 5 degrees.</span></div><div class="line">    <span class="keywordflow">if</span> (fabs(currentTemp - tempSetting) &gt; 5)</div><div class="line">    {</div><div class="line">        <span class="comment">// Turn on the A/C</span></div><div class="line">    }</div><div class="line">}</div><div class="line"> </div><div class="line"><a class="code" href="le__avdata__interface_8h.html#a9adb41270f7420fd269606c12f0a7c4c">le_avdata_CreateResource</a>(<span class="stringliteral">"/room1/thermostat/temperatureControl"</span>, LE_AVDATA_ACCESS_SETTING);</div><div class="line"> </div><div class="line"><a class="code" href="le__avdata__interface_8h.html#adaf94585417ad8cf04efc890e1509f1f">le_avdata_AddResourceEventHandler</a>(<span class="stringliteral">"/room1/thermostat/temperatureControl"</span>, AccessTempSettingHandler, NULL);</div></pre><!-- fragment --><p>Commands do not store values, and must be registered with functions.</p>
<pre class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> FancyFanControl</div><div class="line">(</div><div class="line">    <span class="keywordtype">bool</span> isOn,                 <span class="comment">// false is off, true is on</span></div><div class="line">    <span class="keywordtype">double</span> fanSpeed            <span class="comment">// from 0 to 1, from weakest to the strongest</span></div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="comment">// This demonstrates the ability to return command execution result to the AirVantage server.</span></div><div class="line">    <span class="keywordflow">if</span> (fanSpeed &gt; 1)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86cac409634423b6b1ef09643529f6224798">LE_FAULT</a>;</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="comment">// Actuate the fan with the supplied settings.</span></div><div class="line"> </div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>;</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ExecFanCtrlCmd</div><div class="line">(</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* path,</div><div class="line">    le_avdata_AccessType_t accessType,</div><div class="line">    le_avdata_ArgumentListRef_t argumentList,</div><div class="line">    <span class="keywordtype">void</span>* contextPtr</div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="keywordtype">bool</span> isOn = <span class="keyword">false</span>;</div><div class="line">    <span class="keywordtype">double</span> fanSpeed = 0;</div><div class="line"> </div><div class="line">    <span class="comment">// Obtain the arguments that the AirVantage server sends to the device.</span></div><div class="line">    <span class="comment">// Note that "isOn" and "fanSpeed" are argument names to extract the arguments with.</span></div><div class="line">    <a class="code" href="le__avdata__interface_8h.html#ac51d80f49bf4dcfca8a427fe0a18be59">le_avdata_GetBoolArg</a>(argumentList, <span class="stringliteral">"isOn"</span>, &amp;isOn);</div><div class="line">    <a class="code" href="le__avdata__interface_8h.html#adc5614a36388b455140c51536b1ea1c6">le_avdata_GetFloatArg</a>(argumentList, <span class="stringliteral">"fanSpeed"</span>, &amp;fanSpeed);</div><div class="line"> </div><div class="line">    <span class="comment">// Perform the actual fan control with the arguments</span></div><div class="line">    <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> cmdExeResult = FancyFanControl(isOn, fanSpeed);</div><div class="line"> </div><div class="line">    <span class="comment">// Reply the AirVantage server with the command execution result.</span></div><div class="line">    <a class="code" href="le__avdata__interface_8h.html#aff2cc1ef8d7a1abdd14ebf37382ffc8c">le_avdata_ReplyExecResult</a>(argumentList, cmdExeResult);</div><div class="line">}</div><div class="line"> </div><div class="line"><a class="code" href="le__avdata__interface_8h.html#a9adb41270f7420fd269606c12f0a7c4c">le_avdata_CreateResource</a>(<span class="stringliteral">"/room1/fanControl"</span>, LE_AVDATA_ACCESS_COMMAND);</div><div class="line"> </div><div class="line"><a class="code" href="le__avdata__interface_8h.html#adaf94585417ad8cf04efc890e1509f1f">le_avdata_AddResourceEventHandler</a>(<span class="stringliteral">"/room1/fanControl"</span>, ExecFanCtrlCmd, NULL);</div></pre><!-- fragment --><h1><a class="anchor" id="avData_DataModel"></a>
Asset Data Models</h1>
<p>AirVantage 2.0 removed the need to create Asset Data Models in the <code></code>.cdef. You now have the option to use the <a href="https://doc.airvantage.net//av/reference/cloud/API/">AirVantage Web Services API</a> to control your data, and you do not need to create an Asset Data Model.</p>
<p>If you wish to use the AirVantage Web Portal GUI to control the asset data then you must manually create the model and upload it to the AirVantage Server before being able to control your data.</p>
<p><a href="https://doc.airvantage.net/av/reference/application/">AirVantage Application Format Reference</a> will guide you through creating an Application Model to upload to AirVantage.</p>
<p>Example Application Model </p><pre class="fragment"><div class="line">&lt;?xml version=<span class="stringliteral">"1.0"</span> encoding=<span class="stringliteral">"UTF-8"</span>?&gt;</div><div class="line">&lt;app:application xmlns:app=<span class="stringliteral">"http://www.sierrawireless.com/airvantage/application/1.0"</span> name=<span class="stringliteral">"assetData"</span> type=<span class="stringliteral">"assetData-legato-application"</span> revision=<span class="stringliteral">"1.00"</span>&gt;</div><div class="line">    &lt;application-manager use=<span class="stringliteral">"LWM2M_SW"</span>/&gt;</div><div class="line">    &lt;capabilities&gt;</div><div class="line">        &lt;data&gt;</div><div class="line">            &lt;encoding type=<span class="stringliteral">"LWM2M"</span>&gt;</div><div class="line">                &lt;asset <span class="keywordflow">default</span>-label=<span class="stringliteral">"home1"</span> <span class="keywordtype">id</span>=<span class="stringliteral">"home1"</span>&gt;</div><div class="line">                    &lt;node path=<span class="stringliteral">"room1"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"room1"</span>&gt;</div><div class="line"> </div><div class="line">                        &lt;node path=<span class="stringliteral">"SmartCam"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"SmartCam"</span>&gt;</div><div class="line">                            &lt;variable path=<span class="stringliteral">"numPeople"</span> type=<span class="stringliteral">"int"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"numPeople"</span> /&gt;</div><div class="line">                            &lt;variable path=<span class="stringliteral">"numDogs"</span> type=<span class="stringliteral">"int"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"numDogs"</span> /&gt;</div><div class="line">                        &lt;/node&gt;</div><div class="line"> </div><div class="line">                        &lt;variable path=<span class="stringliteral">"roomName"</span> type=<span class="stringliteral">"string"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"roomName"</span> /&gt;</div><div class="line">                        &lt;variable path=<span class="stringliteral">"isVacant"</span> type=<span class="stringliteral">"boolean"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"isVacant"</span> /&gt;</div><div class="line"> </div><div class="line">                        &lt;node path=<span class="stringliteral">"thermostat"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"thermostat"</span>&gt;</div><div class="line">                            &lt;variable path=<span class="stringliteral">"tempReading"</span> type=<span class="stringliteral">"double"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"tempReading"</span>  /&gt;</div><div class="line">                            &lt;setting path=<span class="stringliteral">"tempSetting"</span> type=<span class="stringliteral">"double"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"tempSetting"</span>/&gt;</div><div class="line">                            &lt;setting path=<span class="stringliteral">"strengthSetting"</span> type=<span class="stringliteral">"int"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"strengthSetting"</span>/&gt;</div><div class="line">                            &lt;setting path=<span class="stringliteral">"powerSetting"</span> type=<span class="stringliteral">"boolean"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"powerSetting"</span>/&gt;</div><div class="line">                            &lt;setting path=<span class="stringliteral">"lcdtextSetting"</span> type=<span class="stringliteral">"string"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"lcdtextSetting"</span>/&gt;</div><div class="line">                        &lt;/node&gt;</div><div class="line"> </div><div class="line">                        &lt;node path=<span class="stringliteral">"fan"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"fan"</span>&gt;</div><div class="line">                            &lt;command path=<span class="stringliteral">"fanControl"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"fanControl"</span>&gt;</div><div class="line">                                &lt;parameter <span class="keywordtype">id</span>=<span class="stringliteral">"customText"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"customText"</span> type=<span class="stringliteral">"string"</span> /&gt;</div><div class="line">                                &lt;parameter <span class="keywordtype">id</span>=<span class="stringliteral">"isOn"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"isOn"</span> type=<span class="stringliteral">"boolean"</span> /&gt;</div><div class="line">                                &lt;parameter <span class="keywordtype">id</span>=<span class="stringliteral">"fanMovement"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"fanMovement"</span> type=<span class="stringliteral">"int"</span> /&gt;</div><div class="line">                                &lt;parameter <span class="keywordtype">id</span>=<span class="stringliteral">"fanSpeed"</span> <span class="keywordflow">default</span>-label=<span class="stringliteral">"fanSpeed"</span> type=<span class="stringliteral">"double"</span> /&gt;</div><div class="line">                            &lt;/command&gt;</div><div class="line">                        &lt;/node&gt;</div><div class="line"> </div><div class="line">                    &lt;/node&gt;</div><div class="line">                &lt;/asset&gt;</div><div class="line">            &lt;/encoding&gt;</div><div class="line">        &lt;/data&gt;</div><div class="line">    &lt;/capabilities&gt;</div><div class="line">&lt;/app:application&gt;</div></pre><!-- fragment --><dl class="section note"><dt>Note</dt><dd>For further details on creating an Asset Data model see the sample application located in the {LEGATO_ROOT}/apps/sample/assetData</dd></dl>
<h1><a class="anchor" id="avData_TimeSeries"></a>
TimeSeries</h1>
<p>A series of data points with time stamps can be collected and sent to the AirVantage server with the Time Series API. This is useful for collecting historical data and analyzing trend.</p>
<p>For example, the room temperature every hour for the past 24 hours.</p>
<pre class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> PushCallbackHandler</div><div class="line">(</div><div class="line">    le_avdata_PushStatus_t status,</div><div class="line">    <span class="keywordtype">void</span>* contextPtr</div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (status == LE_AVDATA_PUSH_SUCCESS)</div><div class="line">    {</div><div class="line">        <span class="comment">// data pushed successfully</span></div><div class="line">    }</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> SendData()</div><div class="line">{</div><div class="line">    <span class="keyword">struct </span>timeval tv;</div><div class="line">    uint64_t utcMilliSec;</div><div class="line">    <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> result;</div><div class="line"> </div><div class="line">    le_avdata_RecordRef_t recRef = <a class="code" href="le__avdata__interface_8h.html#a49d63022c31b5b80ee3538e490346324">le_avdata_CreateRecord</a>();</div><div class="line"> </div><div class="line">    gettimeofday(&amp;tv, NULL);</div><div class="line">    utcMilliSec = (uint64_t)(tv.tv_sec) * 1000 + (uint64_t)(tv.tv_usec) / 1000; <span class="comment">// get current time</span></div><div class="line">    result = <a class="code" href="le__avdata__interface_8h.html#a6bfbffae6b12865d655f79d5e35c1363">le_avdata_RecordFloat</a>(recRef, <span class="stringliteral">"speed"</span>, 0.08, utcMilliSec);</div><div class="line"> </div><div class="line">    <span class="keywordflow">if</span> (result != <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>)</div><div class="line">    {</div><div class="line">         <a class="code" href="le__avdata__interface_8h.html#a0bca8b820b8175e11ad693582fc7f7b5">le_avdata_PushRecord</a>(recRef, PushCallbackHandler, NULL);</div><div class="line">    }</div><div class="line"> </div><div class="line">    <a class="code" href="le__avdata__interface_8h.html#a01949472601455ea064bdfe11cbe5dda">le_avdata_DeleteRecord</a>(recRef);</div><div class="line">}</div><div class="line"> </div><div class="line"><a class="code" href="le__timer_8h.html#a763fa6992488cdce3b5a820817094838">le_timer_Ref_t</a> timer = <a class="code" href="le__timer_8h.html#aee41169a210378b369f440cf99146522">le_timer_Create</a>(<span class="stringliteral">"CollectRoomTemperatureData"</span>);</div><div class="line"><a class="code" href="structle__clk__Time__t.html">le_clk_Time_t</a> interval = {3600, 0}; <span class="comment">// every hour</span></div><div class="line"><a class="code" href="le__timer_8h.html#a0a103d5cef5e83fc9088859d527bbd43">le_timer_SetInterval</a>(timer, interval);</div><div class="line"><a class="code" href="le__timer_8h.html#a292b0a7d6dc0796a36a54fd04c6a7eeb">le_timer_SetRepeat</a>(timer, 0); <span class="comment">// repeat indefinitely</span></div><div class="line"><a class="code" href="le__timer_8h.html#a8fb341f11e0da2692453df997613cb8e">le_timer_SetHandler</a>(timer, ValueUpdate);</div><div class="line"><a class="code" href="le__timer_8h.html#ada2ce7f8cb1e76ed959e323ae94bbfc0">le_timer_Start</a>(timer);</div></pre><!-- fragment --> </div></div>
<br clear="left"/>
</div>
</div>
<link href="resources/css/jqtree.css" rel="stylesheet" type="text/css"/>
<script src="resources/js/tree.jquery.js" type="text/javascript"></script>
<script src="resources/js/jquery.cookie.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<link href="resources/css/perfect-scrollbar.min.css" rel="stylesheet"/>
<script src="resources/js/perfect-scrollbar.jquery.min.js"></script>
</body>
</html>
