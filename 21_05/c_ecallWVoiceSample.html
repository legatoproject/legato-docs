<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html data-context="" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Sample code an eCall test session with a voice call connection  - Legato Docs</title>
<meta content="legato™ is an open source Linux-based embedded platform designed to simplify connected IoT application development" name="description"/>
<meta content="legato, iot" name="keywords"/>
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="21.05.0" name="legato-version"/>
<link href="resources/images/legato.ico" rel="shortcut icon"/>
<link href="resources/images/legato.ico" rel="icon" type="image/x-icon"/>
<link href="resources/images/legato.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="resources/images/legato.ico" rel="apple-touch-icon" type="image/x-icon"/>
<link href="resources/css/style.css" media="screen" rel="stylesheet" type="text/css"/>
<link href="resources/css/font-awesome.css" rel="stylesheet" type="text/css"/>
<!--[if IE]>
    <script src="resources/js/html5shiv.js"></script>
    <script src="resources/js/respond.js"></script>
  <![endif]-->
<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
<script src="resources/js/main.js"></script>
<script src=""></script>
</head>
<body>
<noscript>
<input class="modal-closing-trick" id="modal-closing-trick" type="checkbox"/>
<div id="nojs">
<label for="modal-closing-trick">
<span>You seem to not have Javascript <a href="http://enable-javascript.com">enabled</a>, so site functionality like the search and navigation tree won't work.</span>
</label>
</div>
</noscript>
<div class="wrapper">
<div class="fa fa-bars documentation" id="menu-trigger"></div>
<div id="top">
<header>
<nav>
<a class="navlink" href="/">Introduction</a><a class="navlink" href="buildAppsMain.html">Build Apps</a><a class="navlink" href="buildPlatformMain.html">Build Platform</a><a class="navlink" href="aboutMain.html">About</a>
</nav>
</header>
</div>
<div class="white" id="menudocumentation">
<header>
<a href="/"> <img alt="Back to Legato Homepage" id="logo" src="resources/images/legato_logo.png"/></a>
<h2>/ Legato Documentation</h2>
<nav class="secondary">
</nav>
<nav class="ui-front">
<i class="fa fa-search" id="search-icon"></i>
<input id="searchbox" placeholder="Search"/>
</nav>
</header>
</div>
<div id="resizable">
<div id="left">
<div id="tree1"></div>
</div>
</div>
<div class="content">
<div class="header">
<div class="headertitle">
<h1 class="title">Sample code an eCall test session with a voice call connection </h1> </div>
</div><div class="contents">
<div class="textblock"><pre class="fragment"><div class="line"><span class="comment"> /**</span></div><div class="line"><span class="comment">  * This module implements the le_ecall's test with a voice call connection.</span></div><div class="line"><span class="comment">  *</span></div><div class="line"><span class="comment"> * You must issue the following commands:</span></div><div class="line"><span class="comment"> * @verbatim</span></div><div class="line"><span class="comment">   $ app start eCallWVoice</span></div><div class="line"><span class="comment">   $ app runProc eCallWVoice --exe=eCallWVoice -- &lt;PSAP number&gt;</span></div><div class="line"><span class="comment">   @endverbatim</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">  * Copyright (C) Sierra Wireless Inc.</span></div><div class="line"><span class="comment">  *</span></div><div class="line"><span class="comment">  */</span></div><div class="line"> </div><div class="line"><span class="preprocessor">#include "<a class="code" href="legato_8h.html">legato.h</a>"</span></div><div class="line"><span class="preprocessor">#include "interfaces.h"</span></div><div class="line"> </div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *                     PsapNumber = NULL;</div><div class="line"><span class="keyword">static</span> <a class="code" href="group__le__ecall.html#ga8536728653b7b3cdd6b298c6e7b67705">le_ecall_CallRef_t</a>               LastTestECallRef = NULL;</div><div class="line"> </div><div class="line"><span class="keyword">static</span> <a class="code" href="group__le__audio.html#ga9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> MdmRxAudioRef = NULL;</div><div class="line"><span class="keyword">static</span> <a class="code" href="group__le__audio.html#ga9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> MdmTxAudioRef = NULL;</div><div class="line"><span class="keyword">static</span> <a class="code" href="group__le__audio.html#ga9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> FeInRef = NULL;</div><div class="line"><span class="keyword">static</span> <a class="code" href="group__le__audio.html#ga9a46ff5a5afa61f1bc76120ab9e4da0a">le_audio_StreamRef_t</a> FeOutRef = NULL;</div><div class="line"> </div><div class="line"><span class="keyword">static</span> <a class="code" href="group__le__audio.html#gab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a> AudioInputConnectorRef = NULL;</div><div class="line"><span class="keyword">static</span> <a class="code" href="group__le__audio.html#gab819480f4ce3f36e62b6a4e327668304">le_audio_ConnectorRef_t</a> AudioOutputConnectorRef = NULL;</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Connect audio.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ConnectAudio</div><div class="line">(</div><div class="line">    <span class="keywordtype">void</span></div><div class="line">)</div><div class="line">{</div><div class="line">    <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86c">le_result_t</a> res;</div><div class="line"> </div><div class="line">    MdmRxAudioRef = <a class="code" href="group__le__audio.html#gae3ed568ba4d2763ea77e17e77b20ff02">le_audio_OpenModemVoiceRx</a>();</div><div class="line">    <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((MdmRxAudioRef==NULL), <span class="stringliteral">"OpenModemVoiceRx returns NULL!"</span>);</div><div class="line">    MdmTxAudioRef = <a class="code" href="group__le__audio.html#gad745f008bb04873c817da7af3daf783d">le_audio_OpenModemVoiceTx</a>();</div><div class="line">    <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((MdmTxAudioRef==NULL), <span class="stringliteral">"OpenModemVoiceTx returns NULL!"</span>);</div><div class="line"> </div><div class="line">    <span class="comment">// Redirect audio to the in-built Microphone and Speaker.</span></div><div class="line">    FeOutRef = <a class="code" href="group__le__audio.html#ga5c19afce44021c4abf6193707317f8de">le_audio_OpenSpeaker</a>();</div><div class="line">    <span class="keywordflow">if</span> ((FeOutRef==NULL))</div><div class="line">    {</div><div class="line">        <a class="code" href="le__log_8h.html#a353590f91b3143a7ba3a416ae5a50c3d">LE_ERROR</a>(<span class="stringliteral">"OpenSpeaker returns NULL!"</span>);</div><div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Switching to PCM Inteface..."</span>);</div><div class="line">        <span class="comment">// Redirect audio to the PCM interface.</span></div><div class="line">        FeOutRef = <a class="code" href="group__le__audio.html#ga5e112543e8525775aa670dc71b320766">le_audio_OpenPcmTx</a>(0);</div><div class="line">        <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((FeOutRef==NULL), <span class="stringliteral">"OpenPcmTx returns NULL!"</span>);</div><div class="line">        FeInRef = <a class="code" href="group__le__audio.html#gaa0f0b5fcab8844c67a936d88fa050cf5">le_audio_OpenPcmRx</a>(0);</div><div class="line">        <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((FeInRef==NULL), <span class="stringliteral">"OpenPcmRx returns NULL!"</span>);</div><div class="line"> </div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        FeInRef = <a class="code" href="group__le__audio.html#ga74f1ef979329f6c2bd56ea622f4d05b2">le_audio_OpenMic</a>();</div><div class="line">        <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((FeInRef==NULL), <span class="stringliteral">"OpenMic returns NULL!"</span>);</div><div class="line">    }</div><div class="line"> </div><div class="line">    AudioInputConnectorRef = <a class="code" href="group__le__audio.html#ga570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div><div class="line">    <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((AudioInputConnectorRef==NULL), <span class="stringliteral">"AudioInputConnectorRef is NULL!"</span>);</div><div class="line">    AudioOutputConnectorRef = <a class="code" href="group__le__audio.html#ga570aaf85086f00aca592acfbaaa237be">le_audio_CreateConnector</a>();</div><div class="line">    <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((AudioOutputConnectorRef==NULL), <span class="stringliteral">"AudioOutputConnectorRef is NULL!"</span>);</div><div class="line"> </div><div class="line">    <span class="keywordflow">if</span> (MdmRxAudioRef &amp;&amp; MdmTxAudioRef &amp;&amp; FeOutRef &amp;&amp; FeInRef &amp;&amp;</div><div class="line">        AudioInputConnectorRef &amp;&amp; AudioOutputConnectorRef)</div><div class="line">    {</div><div class="line">        res = <a class="code" href="group__le__audio.html#ga338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(AudioInputConnectorRef, FeInRef);</div><div class="line">        <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((res!=<a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>), <span class="stringliteral">"Failed to connect Mic on Input connector!"</span>);</div><div class="line">        res = <a class="code" href="group__le__audio.html#ga338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(AudioInputConnectorRef, MdmTxAudioRef);</div><div class="line">        <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((res!=<a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>), <span class="stringliteral">"Failed to connect mdmTx on Input connector!"</span>);</div><div class="line">        res = <a class="code" href="group__le__audio.html#ga338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(AudioOutputConnectorRef, FeOutRef);</div><div class="line">        <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((res!=<a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>), <span class="stringliteral">"Failed to connect Speaker on Output connector!"</span>);</div><div class="line">        res = <a class="code" href="group__le__audio.html#ga338df65b2fb1ae0140d86880adbcf0de">le_audio_Connect</a>(AudioOutputConnectorRef, MdmRxAudioRef);</div><div class="line">        <a class="code" href="le__log_8h.html#aceaf11a11691d6c676e36dd317b38dbd">LE_ERROR_IF</a>((res!=<a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>), <span class="stringliteral">"Failed to connect mdmRx on Output connector!"</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Disconnection function.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> DisconnectAudio</div><div class="line">(</div><div class="line">    <span class="keywordtype">void</span></div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (AudioInputConnectorRef)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (FeInRef)</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Disconnect %p from connector.%p"</span>, FeInRef, AudioInputConnectorRef);</div><div class="line">            <a class="code" href="group__le__audio.html#ga6b88df9301038375701e4c15a4c8aaf0">le_audio_Disconnect</a>(AudioInputConnectorRef, FeInRef);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span>(MdmTxAudioRef)</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Disconnect %p from connector.%p"</span>, MdmTxAudioRef, AudioInputConnectorRef);</div><div class="line">            <a class="code" href="group__le__audio.html#ga6b88df9301038375701e4c15a4c8aaf0">le_audio_Disconnect</a>(AudioInputConnectorRef, MdmTxAudioRef);</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(AudioOutputConnectorRef)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span>(FeOutRef)</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Disconnect %p from connector.%p"</span>, FeOutRef, AudioOutputConnectorRef);</div><div class="line">            <a class="code" href="group__le__audio.html#ga6b88df9301038375701e4c15a4c8aaf0">le_audio_Disconnect</a>(AudioOutputConnectorRef, FeOutRef);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span>(MdmRxAudioRef)</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Disconnect %p from connector.%p"</span>, MdmRxAudioRef, AudioOutputConnectorRef);</div><div class="line">            <a class="code" href="group__le__audio.html#ga6b88df9301038375701e4c15a4c8aaf0">le_audio_Disconnect</a>(AudioOutputConnectorRef, MdmRxAudioRef);</div><div class="line">        }</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keywordflow">if</span>(AudioInputConnectorRef)</div><div class="line">    {</div><div class="line">        <a class="code" href="group__le__audio.html#ga3f40b13ff980040503927f59bb3e86a9">le_audio_DeleteConnector</a>(AudioInputConnectorRef);</div><div class="line">        AudioInputConnectorRef = NULL;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(AudioOutputConnectorRef)</div><div class="line">    {</div><div class="line">        <a class="code" href="group__le__audio.html#ga3f40b13ff980040503927f59bb3e86a9">le_audio_DeleteConnector</a>(AudioOutputConnectorRef);</div><div class="line">        AudioOutputConnectorRef = NULL;</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keywordflow">if</span>(FeInRef)</div><div class="line">    {</div><div class="line">        <a class="code" href="group__le__audio.html#gabafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(FeInRef);</div><div class="line">        FeInRef = NULL;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(FeOutRef)</div><div class="line">    {</div><div class="line">        <a class="code" href="group__le__audio.html#gabafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(FeOutRef);</div><div class="line">        FeOutRef = NULL;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(MdmRxAudioRef)</div><div class="line">    {</div><div class="line">        <a class="code" href="group__le__audio.html#gabafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(MdmRxAudioRef);</div><div class="line">        FeOutRef = NULL;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span>(MdmTxAudioRef)</div><div class="line">    {</div><div class="line">        <a class="code" href="group__le__audio.html#gabafeb411da7b1a14b2d5777fc1d3e394">le_audio_Close</a>(MdmTxAudioRef);</div><div class="line">        FeOutRef = NULL;</div><div class="line">    }</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Handler function for eCall state Notifications.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> MyECallEventHandler</div><div class="line">(</div><div class="line">    <a class="code" href="group__le__ecall.html#ga8536728653b7b3cdd6b298c6e7b67705">le_ecall_CallRef_t</a>  eCallRef,</div><div class="line">    <a class="code" href="group__le__ecall.html#ga233609e4724e549a1405f9177c0a07dd">le_ecall_State_t</a>    state,</div><div class="line">    <span class="keywordtype">void</span>*               contextPtr</div><div class="line">)</div><div class="line">{</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall TEST: New eCall state: %d for eCall ref.%p"</span>, state, eCallRef);</div><div class="line"> </div><div class="line">    <span class="keywordflow">switch</span>(state)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda94ba7aacca9dfe74c4733515a7ba2c5e">LE_ECALL_STATE_STARTED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_STARTED."</span>);</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Mute audio interface"</span>);</div><div class="line">            <a class="code" href="group__le__audio.html#ga147e97c49dbc003f63df78f97d5fca32">le_audio_Mute</a>(FeOutRef);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda974a4cdcc060be69502b2eae59962a45">LE_ECALL_STATE_CONNECTED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_CONNECTED."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda085024eb3cca6b48f024f368c6b0f757">LE_ECALL_STATE_DISCONNECTED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_DISCONNECTED."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07ddafeaa941937f098a5d6cc913f9ee2b32f">LE_ECALL_STATE_WAITING_PSAP_START_IND</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_WAITING_PSAP_START_IND."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda2660c7eedfd850b845f0ece7899d5454">LE_ECALL_STATE_PSAP_START_IND_RECEIVED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_PSAP_START_IND_RECEIVED."</span>);</div><div class="line">            <span class="keywordflow">if</span> (<a class="code" href="group__le__ecall.html#ga344e4c29208e576e81dda113f786529e">le_ecall_SendMsd</a>(eCallRef) != <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>)</div><div class="line">            {</div><div class="line">                <a class="code" href="le__log_8h.html#a353590f91b3143a7ba3a416ae5a50c3d">LE_ERROR</a>(<span class="stringliteral">"Could not send the MSD"</span>);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda0e8c495854c6fe3f9fe9285554704572">LE_ECALL_STATE_MSD_TX_STARTED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_MSD_TX_STARTED."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda8699c87772e74835e38573fc9830dba5">LE_ECALL_STATE_LLNACK_RECEIVED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_LLNACK_RECEIVED."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda0410bf309197a2f26910062efb56ed0e">LE_ECALL_STATE_LLACK_RECEIVED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_LLACK_RECEIVED."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07ddae9346b115da82c9583f057ba12d8faa9">LE_ECALL_STATE_MSD_TX_COMPLETED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_MSD_TX_COMPLETED."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda3654bda55c075297e9111acafa90a2bb">LE_ECALL_STATE_MSD_TX_FAILED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_MSD_TX_FAILED."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda5a54611736c5cf7131cc196c694d8060">LE_ECALL_STATE_ALACK_RECEIVED_POSITIVE</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_ALACK_RECEIVED_POSITIVE."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda2b28ed16149c54b6b3d9c57dea4a748f">LE_ECALL_STATE_ALACK_RECEIVED_CLEAR_DOWN</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_ALACK_RECEIVED_CLEAR_DOWN."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda28740cfb795561c243501bff53343175">LE_ECALL_STATE_STOPPED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_STOPPED."</span>);</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Unmute audio interface"</span>);</div><div class="line">            <a class="code" href="group__le__audio.html#gadad24547293481964039efe56bc14e2b">le_audio_Unmute</a>(FeOutRef);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda71a12603e5a05716c7579e12f6f85734">LE_ECALL_STATE_RESET</a>:</div><div class="line">        {</div><div class="line">            <span class="comment">// PSAP has correctly received the MSD</span></div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_RESET."</span>);</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Unmute audio interface"</span>);</div><div class="line">            <a class="code" href="group__le__audio.html#gadad24547293481964039efe56bc14e2b">le_audio_Unmute</a>(FeOutRef);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda40cb68755482f2068f414e4bd1d2bf13">LE_ECALL_STATE_COMPLETED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_COMPLETED."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda5275385371c51e441a9eb97626c271b4">LE_ECALL_STATE_FAILED</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_FAILED."</span>);</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Unmute audio interface"</span>);</div><div class="line">            <a class="code" href="group__le__audio.html#gadad24547293481964039efe56bc14e2b">le_audio_Unmute</a>(FeOutRef);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07ddac5c297a2a70f2490f4f65d72b3a74481">LE_ECALL_STATE_END_OF_REDIAL_PERIOD</a>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"eCall state is LE_ECALL_STATE_END_OF_REDIAL_PERIOD."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">case</span> <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda5c06f82cbeeebb121ab56920a67dbc91">LE_ECALL_STATE_UNKNOWN</a>:</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Unknown eCall state."</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Create and start a test eCall.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> StartTestECall</div><div class="line">(</div><div class="line">    <span class="keywordtype">void</span></div><div class="line">)</div><div class="line">{</div><div class="line">    <a class="code" href="group__le__ecall.html#ga233609e4724e549a1405f9177c0a07dd">le_ecall_State_t</a>                   state = <a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda5c06f82cbeeebb121ab56920a67dbc91">LE_ECALL_STATE_UNKNOWN</a>;</div><div class="line">    <a class="code" href="group__le__ecall.html#ga7e915557fce85b9b82017a80c0d32ddd">le_ecall_StateChangeHandlerRef_t</a>   stateChangeHandlerRef = 0x00;</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Start StartTestECall"</span>);</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((stateChangeHandlerRef = <a class="code" href="group__le__ecall.html#ga453b64579f2884f1d26981bca38a201c">le_ecall_AddStateChangeHandler</a>(MyECallEventHandler, NULL)) != NULL);</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="group__le__ecall.html#gabf9c09914c55cdbe72df1433f60f6e51">le_ecall_SetPsapNumber</a>(PsapNumber) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>);</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="group__le__ecall.html#ga00d3dbc99884375cf2487d6640767c40">le_ecall_SetMsdTxMode</a>(<a class="code" href="group__le__ecall.html#ggadbaa600a7ab66371afddb909b1a113bdafe1cddc2df801a67c7f02020c0dd1127">LE_ECALL_TX_MODE_PUSH</a>) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>);</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>((LastTestECallRef=<a class="code" href="group__le__ecall.html#gaad7fa3b34d9d72a2f1d4baa681ba25cc">le_ecall_Create</a>()) != NULL);</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="group__le__ecall.html#ga2b56b7b7fd7f936c144d30eba7815908">le_ecall_SetMsdPosition</a>(LastTestECallRef, <span class="keyword">true</span>, +48898064, +2218092, 0) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>);</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="group__le__ecall.html#gaf3cfea09eea1b1ba39648798070ad139">le_ecall_SetMsdPositionN1</a>(LastTestECallRef, -11, 22) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>);</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="group__le__ecall.html#ga6b25b9b242ba114f31ae2f853070bf11">le_ecall_SetMsdPositionN2</a>(LastTestECallRef, -33, 44) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>);</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="group__le__ecall.html#ga8c009bb03d61dcd0ffbd9e986b692a85">le_ecall_SetMsdPassengersCount</a>(LastTestECallRef, 3) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>);</div><div class="line"> </div><div class="line">    ConnectAudio();</div><div class="line"> </div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(<a class="code" href="group__le__ecall.html#gaa5d23a1bea370b1ae29fc52d7a89d947">le_ecall_StartTest</a>(LastTestECallRef) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>);</div><div class="line"> </div><div class="line">    state=<a class="code" href="group__le__ecall.html#ga7881e794b9249222edde10f76d7663c9">le_ecall_GetState</a>(LastTestECallRef);</div><div class="line">    <a class="code" href="le__log_8h.html#ac0dbbef91dc0fed449d0092ff0557b39">LE_ASSERT</a>(((state&gt;=<a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda94ba7aacca9dfe74c4733515a7ba2c5e">LE_ECALL_STATE_STARTED</a>) &amp;&amp; (state&lt;=<a class="code" href="group__le__ecall.html#gga233609e4724e549a1405f9177c0a07dda5275385371c51e441a9eb97626c271b4">LE_ECALL_STATE_FAILED</a>)));</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * The signal event handler function for SIGINT/SIGTERM when process dies.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> SigHandler</div><div class="line">(</div><div class="line">    <span class="keywordtype">int</span> sigNum</div><div class="line">)</div><div class="line">{</div><div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"End and delete last test eCall"</span>);</div><div class="line">    <a class="code" href="group__le__ecall.html#ga85800c86f9709fb7baa7219cc762181c">le_ecall_End</a>(LastTestECallRef);</div><div class="line">    <a class="code" href="group__le__ecall.html#gaf1221deb68c46912748f65505b3e4919">le_ecall_Delete</a>(LastTestECallRef);</div><div class="line">    DisconnectAudio();</div><div class="line">    exit(EXIT_SUCCESS);</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Helper.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> PrintUsage()</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> idx;</div><div class="line">    <span class="keywordtype">bool</span> sandboxed = (getuid() != 0);</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> * usagePtr[] = {</div><div class="line">            <span class="stringliteral">"Usage of the eCallWVoice is:"</span>,</div><div class="line">            <span class="stringliteral">"   app runProc eCallWVoice --exe=eCallWVoice -- &lt;PSAP number&gt;"</span>,</div><div class="line">    };</div><div class="line"> </div><div class="line">    <span class="keywordflow">for</span>(idx = 0; idx &lt; <a class="code" href="le__basics_8h.html#a8d8f28a045f43b477cafb67a99894c07">NUM_ARRAY_MEMBERS</a>(usagePtr); idx++)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span>(sandboxed)</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"%s"</span>, usagePtr[idx]);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            fprintf(stderr, <span class="stringliteral">"%s\n"</span>, usagePtr[idx]);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span><span class="comment"></span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * App init.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">//--------------------------------------------------------------------------------------------------</span></div><div class="line"><a class="code" href="le__eventLoop_8h.html#abdb9187a56836a93d19cc793cbd4b7ec">COMPONENT_INIT</a></div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="le__args_8h.html#a6fbbeb423104e6eb92fe47ef42b7310a">le_arg_NumArgs</a>() == 1)</div><div class="line">    {</div><div class="line">        <span class="comment">// Register a signal event handler for SIGINT when user interrupts/terminates process</span></div><div class="line">        signal(SIGINT, SigHandler);</div><div class="line"> </div><div class="line">        PsapNumber = <a class="code" href="le__args_8h.html#a5ebca8229facd069785639cb3c1e273a">le_arg_GetArg</a>(0);</div><div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"======== Start eCallWVoice Test with PSAP.%s ========"</span>, PsapNumber);</div><div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"         Audio will be connected on Analogic or PCM interface."</span>);</div><div class="line">        StartTestECall();</div><div class="line"> </div><div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"======== eCallWVoice Test SUCCESS ========"</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        PrintUsage();</div><div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"EXIT eCallWVoice"</span>);</div><div class="line">        exit(EXIT_FAILURE);</div><div class="line">    }</div><div class="line">}</div></pre><!-- fragment --> </div></div>
<br clear="left"/>
</div>
</div>
<link href="resources/css/jqtree.css" rel="stylesheet" type="text/css"/>
<script src="resources/js/tree.jquery.js" type="text/javascript"></script>
<script src="resources/js/jquery.cookie.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<link href="resources/css/perfect-scrollbar.min.css" rel="stylesheet"/>
<script src="resources/js/perfect-scrollbar.jquery.min.js"></script>
</body>
</html>
