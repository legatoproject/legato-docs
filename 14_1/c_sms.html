<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Legato: SMS Services</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

<link rel="icon" type="image/png" href="favicon.ico">
</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Wireless M2M smooth and connected</div>
  </td>
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('c_sms.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">SMS Services </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="le__sms_8h.html">Click here for the API reference documentation.</a></p>
<hr/>
<p>This file contains data structures and prototypes definitions for high level SMS APIs.</p>
<p><a class="el" href="c_sms.html#le_sms_msg_ops_creating_msg">Creating a Message object</a> <br/>
 <a class="el" href="c_sms.html#le_sms_msg_ops_deleting_msg">Deleting a Message object</a> <br/>
 <a class="el" href="c_sms.html#le_sms_msg_ops_sending">Sending a message</a> <br/>
 <a class="el" href="c_sms.html#le_sms_msg_ops_receiving">Receiving a message</a> <br/>
 <a class="el" href="c_sms.html#le_sms_msg_ops_listing">Listing messages recorded in storage area</a> <br/>
 <a class="el" href="c_sms.html#le_sms_msg_ops_deleting">Deleting a message from the storage area</a> <br/>
</p>
<p>SMS is a common way to communicate in the M2M world.</p>
<p>It's an easy, fast way to send a small amount of data (e.g., sensor values for gas telemetry). Usually, the radio module requests small power resources to send or receive a message. It's often a good way to wake-up a device that was disconnected from the network or that was operating in low power mode.</p>
<h2><a class="anchor" id="le_sms_msg_ops_creating_msg"></a>
Creating a Message object</h2>
<p>There are 3 kinds of supported messages: text messages, binary messages, and PDU messages.</p>
<p>You must create a Message object by calling <code><a class="el" href="le__sms_8h.html#a56f5c913912acfd28d1fdc7c996e0295">le_sms_msg_Create()</a></code> before using the message APIs. It automatically allocates needed resources for the Message object, which is referenced by <code>le_sms_msg_Ref_t</code> type.</p>
<p>When the Message object is no longer needed, call <code><a class="el" href="le__sms_8h.html#ad8412741c747ec366c3df403029c3b95">le_sms_msg_Delete()</a></code> to free all allocated resources associated with the object.</p>
<h2><a class="anchor" id="le_sms_msg_ops_deleting_msg"></a>
Deleting a Message object</h2>
<p>To delete a Message object, call <a class="el" href="le__sms_8h.html#ad8412741c747ec366c3df403029c3b95">le_sms_msg_Delete()</a>. This frees all the resources allocated for the Message object. If several users own the Message object (e.g., several handler functions registered for SMS message reception), the Message object will be deleted only after the last user deletes the Message object.</p>
<h2><a class="anchor" id="le_sms_msg_ops_sending"></a>
Sending a message</h2>
<p>To send a message, create an <code>le_sms_msg_Ref_t</code> object by calling the <code><a class="el" href="le__sms_8h.html#a56f5c913912acfd28d1fdc7c996e0295">le_sms_msg_Create()</a></code> function. Then, set all the needed parameters for the message:</p>
<ul>
<li>Destination telephone number with <a class="el" href="le__sms_8h.html#afee6b2eb05e5c56a82837bd3f8d43371">le_sms_msg_SetDestination()</a>;</li>
<li>Text content with <a class="el" href="le__sms_8h.html#abe60284e9c441636527dfb9da448eb04">le_sms_msg_SetText()</a>, the total length are set as well with this API, maximum 160 characters as only the 7-bit alphabet is supported.</li>
<li>Binary content with <a class="el" href="le__sms_8h.html#ac3ba825778c49e0b6966134833c6160a">le_sms_msg_SetBinary()</a>, total length is set with this API, maximum 140 bytes.</li>
<li>PDU content with <a class="el" href="le__sms_8h.html#af748aa957c534332f510a8ddc470f81b">le_sms_msg_SetPDU()</a>, total length is set with this API, max 36 (header) + 140 (payload) bytes long.</li>
</ul>
<p>After the le_sms_msg_Ref_t object is ready, call <code><a class="el" href="le__sms_8h.html#afc8256b53cd7e528f7e0736b2e6e3faa">le_sms_msg_Send()</a></code>.</p>
<p><code><a class="el" href="le__sms_8h.html#afc8256b53cd7e528f7e0736b2e6e3faa">le_sms_msg_Send()</a></code> is a blocking function, it will return once the Modem has given back a positive or negative answer to the sending operation. The return of <code><a class="el" href="le__sms_8h.html#afc8256b53cd7e528f7e0736b2e6e3faa">le_sms_msg_Send()</a></code> API provides definitive status of the sending operation.</p>
<p>Message object is never deleted regardless of the sending result. Caller has to delete it.</p>
<div class="fragment"><pre class="fragment"> [...]

 <a class="code" href="le__sms_8h.html#a9eb1de4c4f18fd646af2be405b011a06">le_sms_msg_Ref_t</a> myTextMsg;

 <span class="comment">// Create a Message Object</span>
 myTextMsg = <a class="code" href="le__sms_8h.html#a56f5c913912acfd28d1fdc7c996e0295">le_sms_msg_Create</a>();

 <span class="comment">// Set the telephone number</span>
 <a class="code" href="le__sms_8h.html#afee6b2eb05e5c56a82837bd3f8d43371">le_sms_msg_SetDestination</a>(myTextMsg, <span class="stringliteral">&quot;+33606060708&quot;</span>);

 <span class="comment">// Set the message text</span>
 <a class="code" href="le__sms_8h.html#abe60284e9c441636527dfb9da448eb04">le_sms_msg_SetText</a>(myTextMsg, <span class="stringliteral">&quot;Hello, this is a Legato SMS message&quot;</span>);

 <span class="comment">// Send the message</span>
 <a class="code" href="le__sms_8h.html#afc8256b53cd7e528f7e0736b2e6e3faa">le_sms_msg_Send</a>(myTextMsg);

 <span class="comment">// Delete the message</span>
 <a class="code" href="le__sms_8h.html#ad8412741c747ec366c3df403029c3b95">le_sms_msg_Delete</a>(myTextMsg);
</pre></div><h2><a class="anchor" id="le_sms_msg_ops_receiving"></a>
Receiving a message</h2>
<p>To receive SMS messages, register a handler function to obtain incoming messages. Use <code><a class="el" href="le__sms_8h.html#a9c2bcb812602f52b3adcf80ff2d6d354">le_sms_msg_AddRxMessageHandler()</a></code> to register that handler.</p>
<p>The handler must satisfy the following prototype: <code>typedef</code> void (*le_sms_msg_RxMessageHandlerFunc_t)(le_sms_msg_Ref_t msg).</p>
<p>When a new incoming message is received, a Message object is automatically created and the handler is called. This Message object is Read-Only, any calls of a le_sms_msg_SetXXX API will return a LE_NOT_PERMITTED error.</p>
<p>Use the following APIs to retrieve message information and data from the Message object:</p>
<ul>
<li><a class="el" href="le__sms_8h.html#a17d6b6939cd107f57b7f95e2b4699d0b">le_sms_msg_GetFormat()</a> - determine if it is a PDU, a binary or a text message.</li>
<li><a class="el" href="le__sms_8h.html#a6556a1da7f176836c68ba0b66f8a94d7">le_sms_msg_GetSenderTel()</a> - get the sender's Telephone number.</li>
<li><a class="el" href="le__sms_8h.html#ae67c6ba33603fc1766e7fbd7f02731e9">le_sms_msg_GetTimeStamp()</a> - get the timestamp sets by the Service Center.</li>
<li><a class="el" href="le__sms_8h.html#a55622fddf87b35405d1e48c0e90cb592">le_sms_msg_GetUserdataLen()</a> - get the message content (text or binary) length.</li>
<li><a class="el" href="le__sms_8h.html#a32762ec20cb037e123bb19303d6d4212">le_sms_msg_GetPDULen()</a> - get the PDU message .</li>
<li><a class="el" href="le__sms_8h.html#a1b1215728797edfc926bf1348311060c">le_sms_msg_GetText()</a> - get the message text.</li>
<li><a class="el" href="le__sms_8h.html#aa2ef747e0d4b4a825ad9795f74cb094e">le_sms_msg_GetBinary()</a> - get the message binary content.</li>
<li><a class="el" href="le__sms_8h.html#a1c5363ab2e9814af2720164fcd483f2f">le_sms_msg_GetPDU()</a> - get the message PDU data.</li>
</ul>
<dl class="note"><dt><b>Note:</b></dt><dd>If two (or more) registered handler functions exist, they are all called and get the same message object reference.</dd></dl>
<p>If a succession of messages is received, a new Message object is created for each, and the handler is called for each new message.</p>
<p>Uninstall the handler function by calling <code><a class="el" href="le__sms_8h.html#af69c0fa7d191157207e677c67bab4a35">le_sms_msg_RemoveRxMessageHandler()</a></code>. </p>
<dl class="note"><dt><b>Note:</b></dt><dd><code><a class="el" href="le__sms_8h.html#af69c0fa7d191157207e677c67bab4a35">le_sms_msg_RemoveRxMessageHandler()</a></code> API does not delete the Message Object. The caller has to delete it.</dd></dl>
<div class="fragment"><pre class="fragment"> [...]

 <span class="comment">// Handler function for message reception</span>
 <span class="keyword">static</span> <span class="keywordtype">void</span> myMsgHandler(<a class="code" href="le__sms_8h.html#a9eb1de4c4f18fd646af2be405b011a06">le_sms_msg_Ref_t</a> msg)
 {
     <span class="keywordtype">char</span>                tel[<a class="code" href="le__mdm__defs_8h.html#ae8ade945283aa2536178b4528d8545df">LE_SMS_TEL_NMBR_MAX_LEN</a>];
     <span class="keywordtype">char</span>                text[<a class="code" href="le__mdm__defs_8h.html#ac1b7b4dad3b9f7f1fe602494123a10b0">LE_SMS_TEXT_MAX_LEN</a>];
     <a class="code" href="le__mdm__defs_8h.html#a0a1b9c1f16108c60a1ac18e49bdbc990">le_sms_msg_Format_t</a> format;
     uint32_t len=0;

     <a class="code" href="le__sms_8h.html#a17d6b6939cd107f57b7f95e2b4699d0b">le_sms_msg_GetFormat</a>(msg, &amp;format);
     <span class="keywordflow">if</span> (format == LE_SMS_TEXT)
     {
         <a class="code" href="le__sms_8h.html#a6556a1da7f176836c68ba0b66f8a94d7">le_sms_msg_GetSenderTel</a>(msg, tel, &amp;len);
         <a class="code" href="le__sms_8h.html#a1b1215728797edfc926bf1348311060c">le_sms_msg_GetText</a>(msg, text, &amp;len);

         <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot; A new text message has been received !&quot;</span>);
         <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot; From tel.%s, text: \&quot;%s\&quot;&quot;</span>, tel, text);
     }
     <span class="keywordflow">else</span>
     {
         <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot; I support only text messages !&quot;</span>);
     }
 }


 [...]
 <span class="comment">// In the main function:</span>

 int32_t hdlrId=-1;

 <span class="comment">// Add an handler function to handle message reception</span>
 hdlrId=<a class="code" href="le__sms_8h.html#a9c2bcb812602f52b3adcf80ff2d6d354">le_sms_msg_AddRxMessageHandler</a>(myMsgHandler);

 [...]

 <span class="comment">// Remove Handler entry</span>
 <a class="code" href="le__sms_8h.html#af69c0fa7d191157207e677c67bab4a35">le_sms_msg_RemoveRxMessageHandler</a>(hdlrId);

 [...]
</pre></div><h2><a class="anchor" id="le_sms_msg_ops_listing"></a>
Listing  messages recorded in storage area</h2>
<dl class="note"><dt><b>Note:</b></dt><dd>The default SMS message storage area is the SIM card. Change the storage setting through the SMS configuration APIs (available in a future version of API specification).</dd></dl>
<p>Call <code><a class="el" href="le__sms_8h.html#a7ceb32b464883ba2c9573f5fb7b29113">le_sms_msg_CreateRxMsgList()</a></code> to create a List object that lists the received messages present in the storage area, which is referenced by le_sms_msg_ListRef_t type.</p>
<p>If messages are not present, the <a class="el" href="le__sms_8h.html#a7ceb32b464883ba2c9573f5fb7b29113">le_sms_msg_CreateRxMsgList()</a> returns NULL.</p>
<p>Once the list is available, call <code><a class="el" href="le__sms_8h.html#a7b00a9995304275e4a307483db831aae">le_sms_msg_GetFirst()</a></code> to get the first message from the list, and then call <code><a class="el" href="le__sms_8h.html#a5b6abace280b50c402b5716052b665a9">le_sms_msg_GetNext()</a></code> API to get the next message.</p>
<p>Call <code><a class="el" href="le__sms_8h.html#ae811a178b7f1b42d0d417ab21259435c">le_sms_msg_DeleteList()</a></code> to free all allocated resources associated with the List object.</p>
<p>Call <code><a class="el" href="le__sms_8h.html#a6fed5c39592ddf0b1a9cdf4d749e77ae">le_sms_msg_GetStatus()</a></code> to read the status of a message (Received Read, Received Unread).</p>
<p>To finish, you can also modify the received status of a message with <code><a class="el" href="le__sms_8h.html#a60f3ae08f75d9792b73ec77e855ce2e8">le_sms_msg_MarkRead()</a></code> and <code><a class="el" href="le__sms_8h.html#a1211b0b7c4eaeaf0935dc70f9efd1e20">le_sms_msg_MarkUnread()</a></code>.</p>
<h2><a class="anchor" id="le_sms_msg_ops_deleting"></a>
Deleting a message from the storage area</h2>
<dl class="note"><dt><b>Note:</b></dt><dd>The default SMS message storage area is the SIM card. Change this setting through the SMS configuration APIs (available in a future version of API specification).</dd></dl>
<p><code><a class="el" href="le__sms_8h.html#adee6a8ba0f060ae12e0b3d951a07dd01">le_sms_msg_DeleteFromStorage()</a></code> deletes the message from the storage area. Message is identified with <code>le_sms_msg_Ref_t</code> object. The API returns an error if the message is not found in the storage area.</p>
<hr/>
<p>Copyright (C) Sierra Wireless, Inc. 2013. All rights reserved. Use of this work is subject to license. </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
  <div id="nav-path" class="navpath">
    <ul>
   <div class="footer">
        <div>
            <a href="http://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless 2014
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.7.6.1
        </div>
    </div>
</body>
</html>
