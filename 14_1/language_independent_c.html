<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Legato: C Language Support</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

<link rel="icon" type="image/png" href="favicon.ico">
</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Wireless M2M smooth and connected</div>
  </td>
  
  
   
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
   
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('language_independent_c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">C Language Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="language_independent_c.html#ifgen">Interface Generation Tool</a> <br/>
 <a class="el" href="language_independent_c.html#c_handler">Handlers in C</a> <br/>
 <a class="el" href="language_independent_c.html#c_client">Client Specific Functions</a> <br/>
 <a class="el" href="language_independent_c.html#c_server">Server Specific Functions</a></p>
<p>For the C language, five files are generated from the component interface file:</p>
<ul>
<li><b>client interface header file (interface.h)</b> - C definitions for the interface. This file should be included by any C source files that want to use the interface.</li>
</ul>
<ul>
<li><b>server header file (server.h) </b> - C definitions for the server interface. There is some duplication between this file and the interface file, but it also contains definitions that are not part of the public client interface. This file should be included by any C source files that want to implement the interface.</li>
</ul>
<ul>
<li><b>local header file (local.h)</b> - local header file provides common definitions for the client and server implementations. This file should only be included by the client and server implementation files.</li>
</ul>
<ul>
<li><b>client implementation file (client.c) </b> - implements all of the interface functions. These functions handle the details of sending messages to the server, and processing the responses.</li>
</ul>
<ul>
<li><b>server implementation file (server.c)</b> - implements handlers for all the interface functions. These handlers receive the message from the client side, call the corresponding real implementation of the function, and generate any responses back to the client side.</li>
</ul>
<dl class="note"><dt><b>Note:</b></dt><dd>Client and server implementation files are provided to support client/server IPC implementations.</dd></dl>
<h2><a class="anchor" id="ifgen"></a>
Interface Generation Tool</h2>
<p>The <code>ifgen</code> usage details are generated by the <code>-h</code> or <code>--help</code> options:</p>
<div class="fragment"><pre class="fragment">
usage: ifgen [-h] [--gen-all] [--gen-interface] [--gen-local] [--gen-client]
             [--gen-server-interface] [--gen-server] [--async-server]
             [--name-prefix NAMEPREFIX] [--service-tag SERVICETAG]
             [--file-prefix FILEPREFIX] [--user-include USERINCLUDE]
             [--output-dir OUTPUTDIR] [--hash] [--dump]
             FILE

Interface Code Generator

positional arguments:
  FILE                  name of interface file

optional arguments:
  -h, --help            show this help message and exit
  --gen-all             generate all files; overrides individual file options
  --gen-interface       generate interface header file
  --gen-local           generate local header file
  --gen-client          generate client IPC implementation file
  --gen-server-interface
                        generate server interface header file
  --gen-server          generate server IPC implementation file
  --async-server        generate asynchronous-style server functions
  --name-prefix NAMEPREFIX
                        optional prefix for generated functions/types
  --service-tag SERVICETAG
                        optional short name for service
  --file-prefix FILEPREFIX
                        optional prefix for generated files
  --user-include USERINCLUDE
                        optional C include file for extra definitions
  --output-dir OUTPUTDIR
                        optional output directory for generated files
  --hash                print SHA256 hash for interface; NO files are
                        generated
  --dump                print info on parsed functions; NO files are generated
</pre></div><p><b> --async-server option</b></p>
<p>There are two alternatives to implement the server-side functionality.</p>
<p>The default case is where each server-side function has the same interface as the client-side function. The server-side function takes the IN parameters, and returns the OUT parameters when the function exits.</p>
<p>In the async-server case, the server-side function doesn't necessarily return the OUT parameters when it exits. Instead, there's a separate <code>Respond</code> function for each server-side function. The OUT parameters are returned by passing these OUT parameters to the <code>Respond</code> function. The <code>Respond</code> function can be called at any time, normally after the server-side function has exited.</p>
<p>Regardless of how the server-side functions are implemented, the client-side function waits until the OUT parameters are returned.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>In the async-server option only, OUT parameters are both the function return value and any explicit OUT parameters defined for the function.</dd></dl>
<h2><a class="anchor" id="c_handler"></a>
Handlers in C</h2>
<p>This is how a handler in an interface file is mapped to actual C definitions (based on the <a class="el" href="language_independent_syntax.html#example">Interface File Sample</a>).</p>
<div class="fragment"><pre class="fragment">
HANDLER TestA
{
    HANDLER_PARAMS
    (
        int32 x
    );
        
    ADD_HANDLER_PARAMS ();
};
</pre></div><p>This results in two type definitions and two function definitions:</p>
<div class="fragment"><pre class="fragment">
typedef void (*TestAFunc_t)
(
    int32_t x,
    void* contextPtr
);

typedef struct TestA* TestARef_t;

TestARef_t AddTestA
(
    TestAFunc_t handlerPtr,
    void* contextPtr
);

void RemoveTestA
(
    TestARef_t addHandlerRef
);
</pre></div><p>Required parameters for the two functions are added automatically. Since <code>ADD_HANDLER_PARAMS</code> <code>parameterList</code> wasn't given, additional parameters weren't added to the ADD_HANDLER function.</p>
<p>A <code>contextPtr</code> parameter has been automatically added to both the definition of the function pointer, and the definition of the ADD_HANDLER function. The <code>contextPtr</code> passed to the ADD_HANDLER function, will be passed back to the <code>HANDLER</code> function. If the <code>contextPtr</code> is not needed, then NULL can be used.</p>
<h2><a class="anchor" id="c_client"></a>
Client Specific Functions</h2>
<p>These are client-specific functions:</p>
<div class="fragment"><pre class="fragment">
void StartClient
(
    const char* serviceInstanceName
);

void StopClient
(
    void
);
</pre></div><p>To use a service, an initial connection to the server must be created using <code>StartClient()</code>. Only needs to be called once per process; normally done in the COMPONENT_INIT function of the client application. This creates the connection for the main thread. Connections used by other threads are created automatically if other threads use a function provided by a service.</p>
<p>If a client application uses multiple services, multiple <code>StartClient()</code> functions need to be called; each function will have an appropriate prefix to distinguish these clients. If multiple client applications are used, each application must be initialized separately, using the appropriate StartClient() function.</p>
<p>The StopClient() function is used to close a connection to the server. It only closes the connection for the current thread, so must be called separately for each thread that uses a service. At some point later, if a thread starts to use a service, then the connection will be automatically re-created for that thread.</p>
<h2><a class="anchor" id="c_server"></a>
Server Specific Functions</h2>
<p>These are server-specific functions:</p>
<div class="fragment"><pre class="fragment">
le_msg_ServiceRef_t GetServiceRef
(
    void
);

le_msg_SessionRef_t GetClientSessionRef
(
    void
);

void StartServer
(
    const char* serviceInstanceName
);
</pre></div><p>To provide a service, the server must advertise the service to any interested clients using <code>StartServer()</code>. Should be called in the COMPONENT_INIT function of the server daemon implementation.</p>
<p>If a server provides multiple services, multiple <code>StartServer()</code> functions need to be called; each function will have an appropriate prefix to distinguish each service.</p>
<p>The <code>GetServiceRef()</code> function is used to get the server session reference for the current service. Required if the server uses any of the server-specfic <a class="el" href="c_messaging.html">Low-Level Messaging API</a> functions for this service.</p>
<p>For example, <a class="el" href="le__messaging_8h.html#ab0242ce98c7ba7a5f4aa0537bb5bd223">le_msg_SetServiceCloseHandler</a> can be used by the server to register a close handler whenever a client closes its connection. This may be needed to cleanup client specific data maintained by the server.</p>
<p><code>GetClientSessionRef()</code> function is used to get the client session reference for the current service. This client session is only valid while executing the server-side function that implements an interface function. Once this server-side function returns, the client session can no longer be retrieved. <code>GetClientSessionRef()</code> is needed if the server wants to call any of the client specific <a class="el" href="c_messaging.html">Low-Level Messaging API</a> functions for this service.</p>
<p>For example, <a class="el" href="le__messaging_8h.html#a8c04f9cad0a768b4922a9987df84b65f">le_msg_GetClientUserId()</a> can be used by the server to determine the UserId of the client using the service, which allows the server to perform any necessary UserId based authentication.</p>
<hr/>
<p>Copyright (C) Sierra Wireless, Inc. 2014. All rights reserved. Use of this work is subject to license. </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
  <div id="nav-path" class="navpath">
    <ul>
   <div class="footer">
        <div>
            <a href="https://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless 2014
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.7.6.1
        </div>
    </div>
</body>
</html>
