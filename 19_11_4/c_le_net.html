<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html data-context="Build Apps" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>le_net Interface  - Legato Docs</title>
<meta content="legato™ is an open source Linux-based embedded platform designed to simplify connected IoT application development" name="description"/>
<meta content="legato, iot" name="keywords"/>
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<meta content="19.11.4" name="legato-version"/>
<link href="resources/images/legato.ico" rel="shortcut icon"/>
<link href="resources/images/legato.ico" rel="icon" type="image/x-icon"/>
<link href="resources/images/legato.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="resources/images/legato.ico" rel="apple-touch-icon" type="image/x-icon"/>
<link href="resources/css/style.css" media="screen" rel="stylesheet" type="text/css"/>
<link href="resources/css/font-awesome.css" rel="stylesheet" type="text/css"/>
<!--[if IE]>
    <script src="resources/js/html5shiv.js"></script>
    <script src="resources/js/respond.js"></script>
  <![endif]-->
<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
<script src="resources/js/main.js"></script>
<script src="tocs/Build_Apps_Experimental_Features.json"></script>
</head>
<body>
<noscript>
<input class="modal-closing-trick" id="modal-closing-trick" type="checkbox"/>
<div id="nojs">
<label for="modal-closing-trick">
<span>You seem to not have Javascript <a href="http://enable-javascript.com">enabled</a>, so site functionality like the search and navigation tree won't work.</span>
</label>
</div>
</noscript>
<div class="wrapper">
<div class="fa fa-bars documentation" id="menu-trigger"></div>
<div id="top">
<header>
<nav>
<a class="navlink" href="/">Introduction</a><a class="navlink selected" href="buildAppsMain.html">Build Apps</a><a class="navlink" href="buildPlatformMain.html">Build Platform</a><a class="navlink" href="aboutMain.html">About</a>
</nav>
</header>
</div>
<div class="white" id="menudocumentation">
<header>
<a href="/"> <img alt="Back to Legato Homepage" id="logo" src="resources/images/legato_logo.png"/></a>
<h2>/ Build Apps</h2>
<nav class="secondary">
<a href="getStarted.html">Get Started</a><a href="concepts.html">Concepts</a><a href="apiGuidesMain.html">API Guides</a><a href="tools.html">Tools</a><a href="howToMain.html">How To</a><a class="link-selected" href="experimentalMain.html">Experimental Features</a>
</nav>
<nav class="ui-front">
<i class="fa fa-search" id="search-icon"></i>
<input id="searchbox" placeholder="Search"/>
</nav>
</header>
</div>
<div id="resizable">
<div id="left">
<div id="tree1"></div>
</div>
</div>
<div class="content">
<div class="header">
<div class="headertitle">
<h1 class="title">le_net Interface </h1> </div>
</div><div class="contents">
<div class="textblock"><p><a class="el" href="le__net__interface_8h.html">API Reference</a> <br/>
</p>
<p>When applications need to exchange data with other devices on the packet switched data network, a data channel needs to be first established over a connectivity technology like cellular or WiFi. After such channel is successfully established, then applications can open up IP sockets on this data channel as necessary as a data pipe for sending and receiving data.</p>
<p>This <code>le_net</code> interface provides network services to Data Channel Service (DCS) client applications to install, uninstall and manage network configurations, while the <code>le_dcs</code> interface provides APIs for starting (associating with), stopping (disassociating from) selected channels.</p>
<dl class="section warning"><dt>Warning</dt><dd>Since these <code>le_net</code> APIs generate network and route changes that affect all services and applications on the device, users must use them with due diligence and full understanding of their global effects.</dd></dl>
<ul>
<li></li>
</ul>
<h1><a class="anchor" id="le_net_UniqueID"></a>
Unique Identifier</h1>
<p>Like the <code>le_dcs</code> interface, many of the <code>le_net</code> APIs take channel reference, which is assigned and managed by <code>le_dcs</code>, as the input identifier to uniquely identify the channel which assigned network configurations are taken for use.</p>
<h1><a class="anchor" id="le_net_APIOverview"></a>
API Overview</h1>
<p>The <code>le_net</code> interface provides. More details for these APIs can be found in later subsections.</p>
<dl class="section note"><dt>Note</dt><dd>These following APIs have full support for cellular data channels, but only <a class="el" href="le__net__interface_8h.html#af05316d071cf2eaa90ca9244a6a68f73">le_net_ChangeRoute()</a> supports WiFi channels in the moment.</dd></dl>
<table class="doxtable">
<tr>
<th>Function </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="le__net__interface_8h.html#af05316d071cf2eaa90ca9244a6a68f73">le_net_ChangeRoute()</a> </td><td>Add or remove host or network route onto the network interface of a given data channel </td></tr>
<tr>
<td><a class="el" href="le__net__interface_8h.html#a2befa342896c32e579296f8f1fdb8964">le_net_SetDefaultGW()</a> </td><td>Set a device's default gateway addresses to those assigned for a given channel use </td></tr>
<tr>
<td><a class="el" href="le__net__interface_8h.html#ad2c490265021b4871e8ea89c8c4f81d7">le_net_GetDefaultGW()</a> </td><td>Get the default gateway address(es) for the channel provided (retrieved from DHCP lease file) </td></tr>
<tr>
<td><a class="el" href="le__net__interface_8h.html#aedfcfebdb5cccd3970d57dbe6519d40b">le_net_BackupDefaultGW()</a> </td><td>Back up a device's current default gateway addresses </td></tr>
<tr>
<td><a class="el" href="le__net__interface_8h.html#ae4d337ccae4a61438fd6b2ff77dd791e">le_net_RestoreDefaultGW()</a> </td><td>Restore the default gateway addresses of a device previously backed up by <a class="el" href="le__net__interface_8h.html#aedfcfebdb5cccd3970d57dbe6519d40b">le_net_BackupDefaultGW()</a> </td></tr>
<tr>
<td><a class="el" href="le__net__interface_8h.html#a26bf3d29e4cd8b67f9b6e996d9f8777d">le_net_SetDNS()</a> </td><td>Set the DNS server addresses into the device's name server address table </td></tr>
<tr>
<td><a class="el" href="le__net__interface_8h.html#a32b3f14b0d36d0205d3e8178718edfb2">le_net_GetDNS()</a> </td><td>Get the DNS server addresses for the channel provided (retrieved from DHCP lease file) </td></tr>
<tr>
<td><a class="el" href="le__net__interface_8h.html#aa88dffd03a6548e293fa1886afd998f5">le_net_RestoreDNS()</a> </td><td>Remove the DNS server addresses previously added to the device's name server address table </td></tr>
</table>
<h2><a class="anchor" id="le_net_APIDetails_ChangeRoute"></a>
Change Route</h2>
<p>An application can use the <a class="el" href="le__net__interface_8h.html#af05316d071cf2eaa90ca9244a6a68f73">le_net_ChangeRoute()</a> function to add or remove a host or network route onto the network interface of a given channel. The channel reference as an API input identifies the network interface which a route is to be added onto or removed from. Whether the operation is an add or a remove depends on the isAdd boolean value of the last API input argument.</p>
<p>The IP address and mask input arguments specify the destination address and mask for the route. The formats used for them are the same as used in the Linux command "ip route add &lt;ipAddr&gt;/&lt;prefixLength&gt; dev &lt;netInterface&gt;". If the route is a host route, the prefixLength input argument can be given as "" (i.e. null string) or "32". If it is a network route, it should then be specified as a prefix length, such as "16" for 255.255.0.0 or "24" for 255.255.255.0.</p>
<p>The following is some sample code over how to use <a class="el" href="le__net__interface_8h.html#af05316d071cf2eaa90ca9244a6a68f73">le_net_ChangeRoute()</a>: </p><pre class="fragment"><div class="line"><span class="keyword">static</span> le_dcs_ChannelRef_t myChannelRef;</div><div class="line"> </div><div class="line"><span class="keywordtype">void</span> ClientChannelChangeRoute</div><div class="line">(</div><div class="line">    le_dcs_ChannelRef_t channelRef,</div><div class="line">    <span class="keywordtype">char</span> *ipAddr,</div><div class="line">    <span class="keywordtype">char</span> *prefixLength,</div><div class="line">    <span class="keywordtype">bool</span> isAdd</div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a> != <a class="code" href="le__net__interface_8h.html#af05316d071cf2eaa90ca9244a6a68f73">le_net_ChangeRoute</a>(channelRef, ipAddr, prefixLength, isAdd))</div><div class="line">    {</div><div class="line">        <a class="code" href="le__log_8h.html#a353590f91b3143a7ba3a416ae5a50c3d">LE_ERROR</a>(<span class="stringliteral">"Failed to %s route to destination address %s/%s"</span>,</div><div class="line">                 isAdd ? <span class="stringliteral">"add"</span> : <span class="stringliteral">"remove"</span>, ipAddr, prefixLength);</div><div class="line">    }</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="keywordtype">void</span> AddMyHostRoute</div><div class="line">(</div><div class="line">    <span class="keywordtype">void</span></div><div class="line">)</div><div class="line">{</div><div class="line">    ClientChannelChangeRoute(myChannelRef, <span class="stringliteral">"1.1.1.1"</span>, <span class="stringliteral">""</span>, <span class="keyword">true</span>);</div><div class="line">}</div><div class="line"> </div><div class="line"><span class="keywordtype">void</span> ChangeMySubnetRoute</div><div class="line">(</div><div class="line">    <span class="keywordtype">bool</span> isAdd</div><div class="line">)</div><div class="line">{</div><div class="line">    ClientChannelChangeRoute(myChannelRef, <span class="stringliteral">"1.1.0.0"</span>, <span class="stringliteral">"16"</span>, isAdd);</div><div class="line">}</div></pre><!-- fragment --><h2><a class="anchor" id="le_net_APIDetails_DefaultGW"></a>
Default Gateway Address</h2>
<p>The <code>le_net</code> interface provides four APIs for changing the default gateway address on a device. To back up the original setting before changing it, <a class="el" href="le__net__interface_8h.html#aedfcfebdb5cccd3970d57dbe6519d40b">le_net_BackupDefaultGW()</a> can be used. This will save both the default gateway address and the network interface on which it is installed. Later, when this original setting is to be restored, <a class="el" href="le__net__interface_8h.html#ae4d337ccae4a61438fd6b2ff77dd791e">le_net_RestoreDefaultGW()</a> can be used.</p>
<p>To install a different default GW address on a device, <a class="el" href="le__net__interface_8h.html#a2befa342896c32e579296f8f1fdb8964">le_net_SetDefaultGW()</a> can be called with the channel reference of the channel provided, which assigned default gateway address will be used as the device's. Its assigned network interface will be the interface used for this configuration. To query the channel's default GW address prior to installing it on the device, <a class="el" href="le__net__interface_8h.html#ad2c490265021b4871e8ea89c8c4f81d7">le_net_GetDefaultGW()</a> can be used.</p>
<p>The following is some sample code over how to use <a class="el" href="le__net__interface_8h.html#ae4d337ccae4a61438fd6b2ff77dd791e">le_net_RestoreDefaultGW()</a> and <a class="el" href="le__net__interface_8h.html#aedfcfebdb5cccd3970d57dbe6519d40b">le_net_BackupDefaultGW()</a>: </p><pre class="fragment"><div class="line"><span class="keyword">static</span> le_dcs_ChannelRef_t myChannelRef;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> IsDefaultGWAdded = <span class="keyword">false</span>;</div><div class="line"> </div><div class="line"><span class="keywordtype">void</span> ClientConfigNetwork</div><div class="line">(</div><div class="line">    <span class="keywordtype">char</span> *ipAddr,</div><div class="line">    <span class="keywordtype">char</span> *prefixLength,</div><div class="line">    <span class="keywordtype">bool</span> isAdd</div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (isAdd)</div><div class="line">    {</div><div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Adding network configs for channel reference %p"</span>, myChannelRef);</div><div class="line">        <a class="code" href="le__net__interface_8h.html#aedfcfebdb5cccd3970d57dbe6519d40b">le_net_BackupDefaultGW</a>();</div><div class="line">        IsDefaultGWAdded = (<a class="code" href="le__net__interface_8h.html#a2befa342896c32e579296f8f1fdb8964">le_net_SetDefaultGW</a>(myChannelRef) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IsDefaultGWAdded)</div><div class="line">    {</div><div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Restoring network configs for channel reference %p"</span>, myChannelRef);</div><div class="line">        <span class="keywordflow">if</span> (<a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a> != <a class="code" href="le__net__interface_8h.html#ae4d337ccae4a61438fd6b2ff77dd791e">le_net_RestoreDefaultGW</a>())</div><div class="line">        {</div><div class="line">            <a class="code" href="le__log_8h.html#a353590f91b3143a7ba3a416ae5a50c3d">LE_ERROR</a>(<span class="stringliteral">"Failed to restore default gateway addresses"</span>);</div><div class="line">        }</div><div class="line">        IsDefaultGWAdded = <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line"> </div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a> != <a class="code" href="le__net__interface_8h.html#af05316d071cf2eaa90ca9244a6a68f73">le_net_ChangeRoute</a>(myChannelRef, ipAddr, prefixLength, isAdd))</div><div class="line">    {</div><div class="line">        <a class="code" href="le__log_8h.html#a353590f91b3143a7ba3a416ae5a50c3d">LE_ERROR</a>(<span class="stringliteral">"Failed to %s route to destination %s/%s on channel with "</span></div><div class="line">                 <span class="stringliteral">"reference %p"</span>, isAdd ? <span class="stringliteral">"add : "</span><span class="keyword">remove</span><span class="stringliteral">", ipAddr, prefixLength,</span></div><div class="line"><span class="stringliteral">                 myChannelRef);</span></div><div class="line"><span class="stringliteral">    }</span></div><div class="line"><span class="stringliteral">}</span></div></pre><!-- fragment --><h2><a class="anchor" id="le_net_APIDetails_DNS"></a>
DNS Server Addresses</h2>
<p>There are three functions provided for setting a device's DNS server addresses and restoring them. When an application calls <a class="el" href="le__net__interface_8h.html#a26bf3d29e4cd8b67f9b6e996d9f8777d">le_net_SetDNS()</a> to provide a channel reference, <code>le_net</code> would query for the DNS server addresses assigned for this channel's use and add them into the device's global name server address table, which on a typical Linux-based device is at /etc/resolv.conf. The <code>le_net</code> interface would remember this lastly added set of DNS server address. If, for whatever reason, an application needs to know what a channel's DNS server address is, <a class="el" href="le__net__interface_8h.html#a32b3f14b0d36d0205d3e8178718edfb2">le_net_GetDNS()</a> can be used.</p>
<p>When the application is done with the channel, it needs to remove these previously added DNS server addresses from the device's global name server address table, which can be done via <a class="el" href="le__net__interface_8h.html#aa88dffd03a6548e293fa1886afd998f5">le_net_RestoreDNS()</a>. With that called, <code>le_net</code> would retrive from its last archived set of DNS server addresses and seek to delete them from the global table.</p>
<p>Note that for each data channel there could be zero to two DNS server addresses assigned. The <code>le_net</code> interface currently supports both IPv4 and IPv6.</p>
<p>The following is some sample code over how to use <a class="el" href="le__net__interface_8h.html#a26bf3d29e4cd8b67f9b6e996d9f8777d">le_net_SetDNS()</a> and <a class="el" href="le__net__interface_8h.html#aa88dffd03a6548e293fa1886afd998f5">le_net_RestoreDNS()</a>: </p><pre class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> isDnsAdded = <span class="keyword">false</span>;</div><div class="line"> </div><div class="line"><span class="keywordtype">void</span> ClientConfigDNS</div><div class="line">(</div><div class="line">    le_dcs_ChannelRef_t myChannelRef,</div><div class="line">    <span class="keywordtype">bool</span> isAdd</div><div class="line">)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (isAdd)</div><div class="line">    {</div><div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Adding DNS configs for channel reference %p"</span>, myChannelRef);</div><div class="line">        isDnsAdded = (<a class="code" href="le__net__interface_8h.html#a26bf3d29e4cd8b67f9b6e996d9f8777d">le_net_SetDNS</a>(myChannelRef) == <a class="code" href="le__basics_8h.html#a1cca095ed6ebab24b57a636382a6c86ca5066a4bcec691c6b67843b8f79656422">LE_OK</a>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isDnsAdded)</div><div class="line">    {</div><div class="line">        <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">"Restoring DNS configs for channel reference %p"</span>, myChannelRef);</div><div class="line">        <a class="code" href="le__net__interface_8h.html#aa88dffd03a6548e293fa1886afd998f5">le_net_RestoreDNS</a>();</div><div class="line">        isDnsAdded = <span class="keyword">false</span>;</div><div class="line">    }</div><div class="line">}</div></pre><!-- fragment --><p class="copyright">Copyright (C) Sierra Wireless Inc. </p>
</div></div>
<br clear="left"/>
</div>
</div>
<link href="resources/css/jqtree.css" rel="stylesheet" type="text/css"/>
<script src="resources/js/tree.jquery.js" type="text/javascript"></script>
<script src="resources/js/jquery.cookie.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<link href="resources/css/perfect-scrollbar.min.css" rel="stylesheet"/>
<script src="resources/js/perfect-scrollbar.jquery.min.js"></script>
</body>
</html>
