<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Legato: Porting Legacy Apps to Legato</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Simplifying M2M development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('port_legacy_apps.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Porting Legacy Apps to Legato </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Use this method for your legacy apps if:</p>
<ul>
<li>the apps don't require root privileges.</li>
<li>you can't (or don't want to) make changes to source code.</li>
</ul>
<h1><a class="anchor" id="portSelfContained"></a>
Porting Self-contained Apps</h1>
<p>Here's the high-level steps <b>porting your app to Legato</b>:</p>
<ul>
<li>Build the app’s executables and libraries using the legacy program’s build system.</li>
<li>Create an .adef file for your app.</li>
<li>Leave the <code>executables:</code> section in .adef empty.</li>
<li>Include files to be installed as part of the app (executables, libraries, configuration files, devices, etc.) in the <code>files:</code> section of .adef.</li>
<li>Use the <code>requires:</code> section of the <code></code>.adef file to include files and directories that need to be imported into the sandbox from the target’s file system (e.g., /dev/zero, /dev/null).</li>
<li>Add <code>run:</code> lines in the <code>processes:</code> section in the .adef to define processes that should run in the app.</li>
<li>Run <code>mkapp</code> on the .adef file to build the app.</li>
<li>Run <code>instapp</code> on the built app file to install the app on target.</li>
<li>Run <code>app</code> <code>start</code> <code>appName</code> on target to start the app.</li>
</ul>
<p>Here's the <code>foo.adef</code> file (for application foo) that has executables bar1 and bar2 and needs library lib1. The application name should be the same as the .adef file name.</p>
<div class="fragment"><div class="line">bundles:</div>
<div class="line">{</div>
<div class="line">    file:</div>
<div class="line">    {</div>
<div class="line">        [x] bar1    /bin/</div>
<div class="line">        [x] bar2    /bin/</div>
<div class="line">        [r] lib1    /lib/</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">processes:</div>
<div class="line">{</div>
<div class="line">    run:</div>
<div class="line">    {</div>
<div class="line">        (bar1)</div>
<div class="line">        (bar2)</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>To build the app, run: </p>
<div class="fragment"><div class="line">mkapp foo.adef </div>
</div><!-- fragment --><p>Other app settings (e.g., <code>faultAction</code>) can also be set in the .adef files. See <a class="el" href="def_files_adef.html#faultAction">Fault Action</a>.</p>
<h1><a class="anchor" id="portRootAccess"></a>
Porting Apps with Root Access</h1>
<p>Use this method if you're going to change your source code. It's necessary if your legacy apps require root privileges or access to system resources like <code>/proc</code>. This means your app will be ported as a <b>non-sandboxed</b> Legato app.</p>
<p>In the .adef file, you'll have to turn-off sandboxing:</p>
<div class="fragment"><div class="line">sandboxed: <span class="keyword">false</span></div>
</div><!-- fragment --><h1><a class="anchor" id="portUsingAPIs"></a>
Use Legato APIs and Build System</h1>
<p>The preferred method for porting a legacy app to Legato is to use the Legato build system, because it does framework initialization automatically.</p>
<p>To use Legato's build system:</p>
<p><b>Add</b> this to all source files that will call Legato APIs: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="legato_8h.html">legato.h</a>&quot;</span> </div>
</div><!-- fragment --><p><b>Remove</b> the legacy program's <b>main()</b> function. Complete any app-specific initializations and processing in the <code>COMPONENT_INIT</code> function. The Legato build system generates a main() function to initialize the Legato framework and call COMPONENT_INIT. This must be done for each executable in the app.</p>
<p>Optionally, modify the source to use the Legato event loop.</p>
<p>Optionally, modify the source to use Legato signal handlers, memory pools, IPC, etc.</p>
<p><b>Write</b> the <b>adef</b> file for the app. The foo.adef file would be something like:</p>
<div class="fragment"><div class="line">executables:</div>
<div class="line">{</div>
<div class="line">    bar1 = ( bar1.c )</div>
<div class="line">    bar2 = ( bar2.c )</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">processes:</div>
<div class="line">{</div>
<div class="line">    run:</div>
<div class="line">    {</div>
<div class="line">        (bar1)</div>
<div class="line">        (bar2)</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Build</b> the app using <b>mkapp foo.adef -t target</b> where [target] is something like <code>wp7</code> or <code>ar7</code>.</p>
<p><b>Install</b> the app on target using <b>instapp</b>.</p>
<p>The event loop is an essential part of Legato's event-driven apps where programs act only when events are triggered; otherwise, these event-driven apps are idle and don't consume the CPU. Using the event loop, each thread in the program has its own event queue.</p>
<p>Legacy apps may choose not to use the Legato event loop and can instead run their programs using legacy event processing.</p>
<dl class="section note"><dt>Note</dt><dd>If legacy event handling is used in conjunction with the Legato event loop, extreme care must be taken so the two systems don't interfere with each other.</dd></dl>
<p>Legato memory pools can also be used to allow programs to control memory use in a deterministic way; this avoids memory fragmentation, gives memory corruption protection, and allows Legato diagnostic tools to examine memory usage.</p>
<p>Legato apps don't use <code>malloc()</code> and <code>free()</code> directly. If legacy apps use malloc() and free(), they won't have the benefits of Legato memory pools.</p>
<dl class="section warning"><dt>Warning</dt><dd>If memory pools are used in conjunction with malloc() and free(), memory fragmentation could occur.</dd></dl>
<h1><a class="anchor" id="ownMainFunc"></a>
Use Your Own main() with Legato APIs</h1>
<p>Another option when porting legacy apps is to continue to use your own main() function and build system, and still take advantage of the Legato APIs.</p>
<p>To use the Legato APIs, you'll need to link the <code>liblegato.so</code> library and include <code><a class="el" href="legato_8h.html">legato.h</a></code> in any source files that call Legato APIs. The <code>_legato_InitFramework()</code> function should be called before any Legato API functions are called.</p>
<p>Related info:</p>
<p><a class="el" href="def_files.html">Definition Files</a> <br/>
 <a class="el" href="app_creating.html">Create Applications</a> <br/>
 <a class="el" href="component_writing.html">Write Components</a></p>
<hr/>
<p>Copyright (C) Sierra Wireless, Inc. 2014. Use of this work is subject to license. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="http://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless 2014
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.6
        </div>
    </div>
</body>
</html>
