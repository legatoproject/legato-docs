<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Legato: Hello IPC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="fonts.css" rel="stylesheet" type="text/css" />
<link href="legato.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link rel="icon" type="image/png" href="favicon.ico" />
</head>
<body>
<div id="top"><!-- do not remove this div! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo">
    <img alt="Logo" src="legatoLogo.png"/>
    <div id="projectbrief">Simplifying M2M development</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('componenthello_i_p_c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Hello IPC </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Lets explore how to use IPC between components:</p>
<ul>
<li>Define a simple interface protocol that clients can use to ask servers to "Greet".</li>
<li>Create a server that prints "Hello world" whenever a client asks it to "Greet",</li>
<li>Create a client that asks the server to "Greet",</li>
</ul>
<p>Here's what it looks like at runtime:</p>
<div class="image">
<img src="HelloIPC.png" alt="HelloIPC.png"/>
</div>
<p>When we show the static view of components inside executables, it looks like this:</p>
<div class="image">
<img src="HelloIPCWithComponents.png" alt="HelloIPCWithComponents.png"/>
</div>
<p>Note that each interface has</p>
<ul>
<li>an interface protocol</li>
<li>a friendly name.</li>
</ul>
<p>In our example, the client and server both use the same friendly name "hello" for their interfaces, and of course, they both must use the same protocol, or they wouldn't be able to communicate with each other.</p>
<h1><a class="anchor" id="helloIPCGettingStarted"></a>
Getting Started</h1>
<p>First, let's create a directory for our little project and change directories into there:</p>
<pre class="fragment">$ mkdir helloIPC
$ cd helloIPC
</pre><h1><a class="anchor" id="helloIPCDefiningTheAPI"></a>
Defining the Interface Protocol</h1>
<p>Next, we define the interface protocol to be used between the client and the server.</p>
<p>To create our function-call API, we create a definition file called "greet.api".</p>
<pre class="fragment">$ gedit greet.api
</pre><p>Put the following inside greet.api:</p>
<pre class="fragment">FUNCTION Greet
(
);
</pre><p>This declares a function called "Greet" that takes no arguments and returns nothing.</p>
<h1><a class="anchor" id="helloIPCCreatingTheServer"></a>
Creating the Server</h1>
<p>Next we create a server component called "greetServer" that offers a greeting service called "hello" that can be accessed using our simple "greet" API. We do this by creating a file called "Component.cdef" in a new directory called "greetServer".</p>
<pre class="fragment">$ mkdir greetServer
$ gedit greetServer/Component.cdef
</pre><dl class="section note"><dt>Note</dt><dd>Keeping components in separate directories from each other is a requirement of the framework.</dd></dl>
<p>greetServer/Component.cdef should contain the following:</p>
<div class="fragment"><div class="line">export:</div>
<div class="line"></div>
<div class="line">    hello = greet.api</div>
<div class="line"></div>
<div class="line">sources:</div>
<div class="line"></div>
<div class="line">    greetServer.c</div>
</div><!-- fragment --><p>This declares that the component named "greetServer" (the name of the directory is the name of the component) exports a service called "hello" that is accessed using the API defined in "greet.api", where the source code can be found in the file greetServer.c.</p>
<dl class="section note"><dt>Note</dt><dd>The source code file name extension is used to determine the programming language that it is written in.</dd></dl>
<p>To implement the server (in C), create a file "greetServer/greetServer.c":</p>
<pre class="fragment">$ gedit greetServer/greetServer.c
</pre><p>Make it contain the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="legato_8h.html">legato.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;interfaces.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> hello_Greet(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="le__log_8h.html#a23e6d206faa64f612045d688cdde5808">LE_INFO</a>(<span class="stringliteral">&quot;Hello world.&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">COMPONENT_INIT</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p>The file "interfaces.h" will be auto-generated based on the contents of greet.api and greetServer's Component.cdef. It will contain a prototype of the function hello_Greet(), which we implemented in greetServer.c.</p>
<p>The function hello_Greet() will be called when a client binds to our "hello" service and calls the function Greet(). The name "hello_Greet" follows this pattern:</p>
<pre class="fragment">&lt;export-name&gt; '_' &lt;api-function-name&gt;
</pre><p>The &lt;export-name&gt; is the name given to the exported interface. In our example, it is the name "hello" before the '=' in the line "hello = greet.api".</p>
<dl class="section note"><dt>Note</dt><dd>If you forget to implement a service function on the server or if you give it the wrong name, the link stage will fail and complain that the symbol is unresolved, so you'll know that you missed a function and you'll be able to see what the correct name of the function should be.</dd></dl>
<h1><a class="anchor" id="helloIPCCreatingTheClient"></a>
Creating the Client</h1>
<p>Now that we have a server, let's create a client to use its service. First, create a directory for the greetClient component and a file in it called "Component.cdef".</p>
<pre class="fragment">$ mkdir greetClient
$ gedit greetClient/Component.cdef
</pre><p>greetClient/Component.cdef should contain:</p>
<pre class="fragment">import:

    hello = greet.api

sources:

    greetClient.c
</pre><p>To implement the client using C, create a file called "greetClient/greetClient.c":</p>
<pre class="fragment">$ gedit greetClient/greetClient.c
</pre><p>Make it contain the following:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="legato_8h.html">legato.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;interfaces.h&quot;</span></div>
<div class="line"></div>
<div class="line">COMPONENT_INIT</div>
<div class="line">{</div>
<div class="line">    hello_Greet();</div>
<div class="line">}</div>
</div><!-- fragment --><p>The "interfaces.h" file that the client includes is a different one than the one that the server uses. This one is specially generated for the client based on the contents of greetClient/Component.cdef and greet.api.</p>
<p>In the client, we use the component initializer to call hello_Greet() at start-up.</p>
<hr/>
<p>Copyright (C) Sierra Wireless, Inc. 2014. All rights reserved. Use of this work is subject to license. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
   <div class="footer">
        <div>
            <a href="http://www.sierrawireless.com/">
                <img src="swi-ico-medium.png" width="24" alt="" />
                &nbsp;Sierra Wireless 2014
            </a>
            &nbsp;-&nbsp;
            Generated by Doxygen 1.8.6
        </div>
    </div>
</body>
</html>
